<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Development &mdash; Behat 3.0.12 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/normalize.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/borg.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/documentation.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Comfortaa" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0.12',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Behat 3.0.12 documentation" href="../index.html" />
    <link rel="up" title="Quick Start" href="../quick_start.html" />
    <link rel="next" title="User Guide" href="../user_guide.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
  </head>
  <body role="document">
    <header>
        <a class="logo" href="http://behat.org">behat</a>

        <nav>
            <ul>
                <li><a href="http://behat.org">About</a></li>
                <li class="active"><a href="/">Docs</a></li>
            </ul>
        </nav>

        <a class="fork" href="https://github.com/Behat/Behat">Fork us</a>
    </header>

    <section>

        <nav class="toc">
            <h3>Chapters</h3>
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../quick_start.html">Quick Start</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="example.html">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Development</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cookbooks.html">Cookbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_resources.html">Useful Resources</a></li>
</ul>

            
        </nav>
        <section class="text">
            
  <div class="section" id="development">
<h1>Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h1>
<p>Now we will use our newly installed Behat to automate our previously written
feature under the <code class="docutils literal"><span class="pre">features/basket.feature</span></code>.</p>
<p>Our first step after describing the feature and installing Behat is configuring
the test suite. A test suite is a key concept in Behat. Suites are a way for Behat
to know where to find and how to test your application against your features.
By default, Behat comes with a <code class="docutils literal"><span class="pre">default</span></code> suite, which tells Behat to search
for features under the <code class="docutils literal"><span class="pre">features/</span></code> folder and test them using <code class="docutils literal"><span class="pre">FeatureContext</span></code>
class. Lets initialise this suite:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>vendor/bin/behat --init
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you installed Behat via PHAR, use <code class="docutils literal"><span class="pre">php</span> <span class="pre">behat.phar</span></code> instead of
<code class="docutils literal"><span class="pre">vendor/bin/behat</span></code> in the rest of this article.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">--init</span></code> command tells Behat to provide you with things missing
to start testing your feature. In our case - it&#8217;s just a <code class="docutils literal"><span class="pre">FeatureContext</span></code>
class under the <code class="docutils literal"><span class="pre">features/bootstrap/FeatureContext.php</span></code> file.</p>
<div class="section" id="executing-behat">
<h2>Executing Behat<a class="headerlink" href="#executing-behat" title="Permalink to this headline">¶</a></h2>
<p>I think we&#8217;re ready to see Behat in action! Let&#8217;s run it:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>vendor/bin/behat
</pre></div>
</div>
<p>You should see that Behat recognised that you have 3 scenarios. Behat should
also tell you that your <code class="docutils literal"><span class="pre">FeatureContext</span></code> class has missing steps and proposes
step snippets for you. <code class="docutils literal"><span class="pre">FeatureContext</span></code> is your test environment. It is an
object through which you will describe how you would test your application against
your features. It was generated by the <code class="docutils literal"><span class="pre">--init</span></code> command and now looks like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// features/bootstrap/FeatureContext.php</span>

<span class="k">use</span> <span class="nx">Behat\Behat\Context\SnippetAcceptingContext</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Behat\Gherkin\Node\PyStringNode</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Behat\Gherkin\Node\TableNode</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FeatureContext</span> <span class="k">implements</span> <span class="nx">SnippetAcceptingContext</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Initializes context.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-steps">
<h2>Defining Steps<a class="headerlink" href="#defining-steps" title="Permalink to this headline">¶</a></h2>
<p>Finally, we got to the automation part. How does Behat knows what to do
when it sees <code class="docutils literal"><span class="pre">Given</span> <span class="pre">there</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">&quot;Sith</span> <span class="pre">Lord</span> <span class="pre">Lightsaber&quot;,</span> <span class="pre">which</span> <span class="pre">costs</span> <span class="pre">£5</span></code>? You
tell it. You write PHP code inside your context class (<code class="docutils literal"><span class="pre">FeatureContext</span></code>
in our case) and tell Behat that this code represents a specific scenario step
(via an annotation with a pattern):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="sd">/**</span>
<span class="sd"> * @Given there is a(n) :arg1, which costs £:arg2</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">thereIsAWhichCostsPs</span><span class="p">(</span><span class="nv">$arg1</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">PendingException</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">/**</span> <span class="pre">...</span> <span class="pre">*/</span></code> is a special syntax in PHP called a doc-block. It is
discoverable at runtime and used by different PHP frameworks as a
way to provide additional meta-information for the classes, methods and
functions. Behat uses doc-blocks for step definitions, step
transformations and hooks.</p>
</div>
<p><code class="docutils literal"><span class="pre">&#64;Given</span> <span class="pre">there</span> <span class="pre">is</span> <span class="pre">a(n)</span> <span class="pre">:arg1,</span> <span class="pre">which</span> <span class="pre">costs</span> <span class="pre">£:arg2</span></code> above the method tells Behat
that this particular method should be executed whenever Behat sees step that
looks like <code class="docutils literal"><span class="pre">...</span> <span class="pre">there</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">...,</span> <span class="pre">which</span> <span class="pre">costs</span> <span class="pre">£...</span></code>. This pattern will match
any of the following steps:</p>
<div class="highlight-gherkin"><div class="highlight"><pre><span class="k">Given </span><span class="nf">there is a &quot;</span><span class="s">Sith Lord Lightsaber</span><span class="nf">&quot;, which costs £</span><span class="s">5</span><span class="nf"></span>
<span class="k">When </span><span class="nf">there is a &quot;</span><span class="s">Sith Lord Lightsaber</span><span class="nf">&quot;, which costs £</span><span class="s">10</span><span class="nf"></span>
<span class="k">Then </span><span class="nf">there is an &#39;Anakin Lightsaber&#39;, which costs £</span><span class="s">10</span><span class="nf"></span>
<span class="k">And </span><span class="nf">there is a Lightsaber, which costs £</span><span class="s">2</span><span class="nf"></span>
<span class="k">But </span><span class="nf">there is a Lightsaber, which costs £</span><span class="s">25</span><span class="nf"></span>
</pre></div>
</div>
<p>Not only that, but Behat will capture tokens (words starting with <code class="docutils literal"><span class="pre">:</span></code>, e.g.
<code class="docutils literal"><span class="pre">:arg1</span></code>) from the step and pass their value to the method as arguments:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// Given there is a &quot;Sith Lord Lightsaber&quot;, which costs £5</span>
<span class="nv">$context</span><span class="o">-&gt;</span><span class="na">thereIsAWhichCostsPs</span><span class="p">(</span><span class="s1">&#39;Sith Lord Lightsaber&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">);</span>

<span class="c1">// Then there is a &#39;Jedi Lightsaber&#39;, which costs £10</span>
<span class="nv">$context</span><span class="o">-&gt;</span><span class="na">thereIsAWhichCostsPs</span><span class="p">(</span><span class="s1">&#39;Jedi Lightsaber&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">);</span>

<span class="c1">// But there is a Lightsaber, which costs £25</span>
<span class="nv">$context</span><span class="o">-&gt;</span><span class="na">thereIsAWhichCostsPs</span><span class="p">(</span><span class="s1">&#39;Lightsaber&#39;</span><span class="p">,</span> <span class="s1">&#39;25&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you need to define more complex matching algorithms, you can also use regular
expressions:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="sd">/**</span>
<span class="sd"> * @Given /there is an? \&quot;([^\&quot;]+)\&quot;, which costs £([\d\.]+)/</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">thereIsAWhichCostsPs</span><span class="p">(</span><span class="nv">$arg1</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">PendingException</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Those patterns could be quite powerful, but at the same time, writing them for all
possible steps manually could become extremely tedious and boring. That&#8217;s why Behat
does it for you. Remember when you previously executed <code class="docutils literal"><span class="pre">vendor/bin/behat</span></code> you
got:</p>
<div class="highlight-text"><div class="highlight"><pre>--- FeatureContext has missing steps. Define them with these snippets:

    /**
     * @Given there is a :arg1, which costs £:arg2
     */
    public function thereIsAWhichCostsPs($arg1, $arg2)
    {
        throw new PendingException();
    }
</pre></div>
</div>
<p>Behat automatically generates snippets for missing steps and all that you need to
do is copy and paste them into your context classes. Or there is an even easier
way - just run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>vendor/bin/behat --dry-run --append-snippets
</pre></div>
</div>
<p>And Behat will automatically append all the missing step methods into your
<code class="docutils literal"><span class="pre">FeatureContext</span></code> class. How cool is that?</p>
<p>If you executed <code class="docutils literal"><span class="pre">--append-snippets</span></code>, your <code class="docutils literal"><span class="pre">FeatureContext</span></code> should look like:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// features/bootstrap/FeatureContext.php</span>

<span class="k">use</span> <span class="nx">Behat\Behat\Tester\Exception\PendingException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Behat\Behat\Context\SnippetAcceptingContext</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Behat\Gherkin\Node\PyStringNode</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Behat\Gherkin\Node\TableNode</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FeatureContext</span> <span class="k">implements</span> <span class="nx">SnippetAcceptingContext</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Given there is a :arg1, which costs £:arg2</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">thereIsAWhichCostsPs</span><span class="p">(</span><span class="nv">$arg1</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">PendingException</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @When I add the :arg1 to the basket</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">iAddTheToTheBasket</span><span class="p">(</span><span class="nv">$arg1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">PendingException</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @Then I should have :arg1 product(s) in the basket</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">iShouldHaveProductInTheBasket</span><span class="p">(</span><span class="nv">$arg1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">PendingException</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @Then the overall basket price should be £:arg1</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">theOverallBasketPriceShouldBePs</span><span class="p">(</span><span class="nv">$arg1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">PendingException</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We have removed the constructor and grouped <code class="docutils literal"><span class="pre">I</span> <span class="pre">should</span> <span class="pre">have</span> <span class="pre">:arg1</span> <span class="pre">product</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">basket</span></code>
and <code class="docutils literal"><span class="pre">I</span> <span class="pre">should</span> <span class="pre">have</span> <span class="pre">:arg1</span> <span class="pre">products</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">basket</span></code> into one
<code class="docutils literal"><span class="pre">I</span> <span class="pre">should</span> <span class="pre">have</span> <span class="pre">:arg1</span> <span class="pre">product(s)</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">basket</span></code>.</p>
</div>
</div>
<div class="section" id="automating-steps">
<h2>Automating Steps<a class="headerlink" href="#automating-steps" title="Permalink to this headline">¶</a></h2>
<p>Now it is finally time to start implementing our basket feature. The approach when
you use tests to drive your application development is called a Test-Driven Development
(or simply TDD). With TDD you start by defining test cases for the functionality you
develop, then you fill these test cases with the best-looking application code you could
come up with (use your design skills and imagination).</p>
<p>In the case of Behat, you already have defined test cases (step definitions in your
<code class="docutils literal"><span class="pre">FeatureContext</span></code>) and the only thing that is missing is that best-looking application
code we could come up with to fulfil our scenario. Something like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// features/bootstrap/FeatureContext.php</span>

<span class="k">use</span> <span class="nx">Behat\Behat\Tester\Exception\PendingException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Behat\Behat\Context\SnippetAcceptingContext</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Behat\Gherkin\Node\PyStringNode</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Behat\Gherkin\Node\TableNode</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FeatureContext</span> <span class="k">implements</span> <span class="nx">SnippetAcceptingContext</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$shelf</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$basket</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">shelf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Shelf</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">basket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Basket</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">shelf</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @Given there is a :product, which costs £:price</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">thereIsAWhichCostsPs</span><span class="p">(</span><span class="nv">$product</span><span class="p">,</span> <span class="nv">$price</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">shelf</span><span class="o">-&gt;</span><span class="na">setProductPrice</span><span class="p">(</span><span class="nv">$product</span><span class="p">,</span> <span class="nb">floatval</span><span class="p">(</span><span class="nv">$price</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @When I add the :product to the basket</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">iAddTheToTheBasket</span><span class="p">(</span><span class="nv">$product</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">basket</span><span class="o">-&gt;</span><span class="na">addProduct</span><span class="p">(</span><span class="nv">$product</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @Then I should have :count product(s) in the basket</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">iShouldHaveProductInTheBasket</span><span class="p">(</span><span class="nv">$count</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">PHPUnit_Framework_Assert</span><span class="o">::</span><span class="na">assertCount</span><span class="p">(</span>
            <span class="nb">intval</span><span class="p">(</span><span class="nv">$count</span><span class="p">),</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">basket</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @Then the overall basket price should be £:price</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">theOverallBasketPriceShouldBePs</span><span class="p">(</span><span class="nv">$price</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">PHPUnit_Framework_Assert</span><span class="o">::</span><span class="na">assertSame</span><span class="p">(</span>
            <span class="nb">floatval</span><span class="p">(</span><span class="nv">$price</span><span class="p">),</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">basket</span><span class="o">-&gt;</span><span class="na">getTotalPrice</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see, in order to test and implement our application, we introduced 2 objects -
<code class="docutils literal"><span class="pre">Shelf</span></code> and <code class="docutils literal"><span class="pre">Basket</span></code>. The first is responsible for storing products and their prices,
the second is responsible for the representation of our customer basket. Through appropriate step
definitions we declare products&#8217; prices and add products to the basket. We then compare the
state of our <code class="docutils literal"><span class="pre">Basket</span></code> object with our expectations using PHPUnit assertions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Behat doesn&#8217;t come with its own assertion tool, but you can use any proper assertion
tool out there. A proper assertion tool is a library whose assertions throw
exceptions on failure. For example, if you&#8217;re familiar with PHPUnit you can use
its assertions in Behat by installing it via composer:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>php composer.phar require --dev phpunit/phpunit<span class="o">=</span><span class="s1">&#39;~4.1.0&#39;</span>
</pre></div>
</div>
<p>and then by simply using assertions in your steps:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nx">PHPUnit_Framework_Assert</span><span class="o">::</span><span class="na">assertCount</span><span class="p">(</span>
    <span class="nb">intval</span><span class="p">(</span><span class="nv">$count</span><span class="p">),</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">basket</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<p>Now try to execute your feature tests:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>vendor/bin/behat
</pre></div>
</div>
<p>You should see a beginning of the feature and then an error saying that class <code class="docutils literal"><span class="pre">Shelf</span></code>
does not exist. It means we&#8217;re ready to start writing actual application code!</p>
</div>
<div class="section" id="implementing-the-feature">
<h2>Implementing the Feature<a class="headerlink" href="#implementing-the-feature" title="Permalink to this headline">¶</a></h2>
<p>So now we have 2 very important things:</p>
<ol class="arabic simple">
<li>A concrete user-aimed description of functionality we&#8217;re trying to deliver.</li>
<li>Set of failing tests that tell us what to do next.</li>
</ol>
<p>Now is the easiest part of application development - feature implementation. Yes, with
TDD and BDD implementation becomes a routine task, because you already did most of the
job in the previous phases - you wrote tests, you came up with an elegant solution (as far
as you could go in current context) and you chose the actors (objects) and actions
(methods) that are involved. Now it&#8217;s time to write a bunch of PHP keywords to glue it
all together. Tools like Behat, when used in the right way, will help you to write this
phase by giving you a simple set of instructions that you need to follow. You
did your thinking and design, now it&#8217;s time to sit back, run the tool and follow its
instructions in order to write your production code.</p>
<p>Lets start! Run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>vendor/bin/behat
</pre></div>
</div>
<p>Behat will try to test your application with <code class="docutils literal"><span class="pre">FeatureContext</span></code> but will fail soon,
producing something like this onto your screen:</p>
<div class="highlight-text"><div class="highlight"><pre>Fatal error: Class &#39;Shelf&#39; not found
</pre></div>
</div>
<p>Now our job is to reinterpret this phrase into an actionable instruction. Like
&#8220;Create the <code class="docutils literal"><span class="pre">Shelf</span></code> class&#8221;. Let&#8217;s go and create it inside <code class="docutils literal"><span class="pre">features/bootstrap</span></code>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// features/bootstrap/Shelf.php</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">Shelf</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We put the <code class="docutils literal"><span class="pre">Shelf</span></code> class into <code class="docutils literal"><span class="pre">features/bootstrap/Shelf.php</span></code> because
<code class="docutils literal"><span class="pre">features/bootstrap</span></code> is an autoloading folder for Behat. Behat has a built-in
PSR-0 autoloader, which looks into <code class="docutils literal"><span class="pre">features/bootstrap</span></code>. If you&#8217;re developing
your own application, you probably would want to put classes into a place
appropriate for your app.</p>
</div>
<p>Let&#8217;s run Behat again:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>vendor/bin/behat
</pre></div>
</div>
<p>We will get different message on our screen:</p>
<div class="highlight-text"><div class="highlight"><pre>Fatal error: Class &#39;Basket&#39; not found
</pre></div>
</div>
<p>Good, we are progressing! Reinterpreting the message as, &#8220;Create the <code class="docutils literal"><span class="pre">Basket</span></code> class&#8221;.
Let&#8217;s follow our new instruction:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// features/bootstrap/Basket.php</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">Basket</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Run Behat again:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>vendor/bin/behat
</pre></div>
</div>
<p>Great! Another &#8220;instruction&#8221;:</p>
<div class="highlight-text"><div class="highlight"><pre>Call to undefined method Shelf::setProductPrice()
</pre></div>
</div>
<p>Follow these instructions step-by-step and you will end up with <code class="docutils literal"><span class="pre">Shelf</span></code>
class looking like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// features/bootstrap/Shelf.php</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">Shelf</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$priceMap</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setProductPrice</span><span class="p">(</span><span class="nv">$product</span><span class="p">,</span> <span class="nv">$price</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">priceMap</span><span class="p">[</span><span class="nv">$product</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$price</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getProductPrice</span><span class="p">(</span><span class="nv">$product</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">priceMap</span><span class="p">[</span><span class="nv">$product</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and <code class="docutils literal"><span class="pre">Basket</span></code> class looking like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// features/bootstrap/Basket.php</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">Basket</span> <span class="k">implements</span> <span class="nx">\Countable</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$shelf</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$products</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$productsPrice</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Shelf</span> <span class="nv">$shelf</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">shelf</span> <span class="o">=</span> <span class="nv">$shelf</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addProduct</span><span class="p">(</span><span class="nv">$product</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">products</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$product</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">productsPrice</span> <span class="o">+=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">shelf</span><span class="o">-&gt;</span><span class="na">getProductPrice</span><span class="p">(</span><span class="nv">$product</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTotalPrice</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">productsPrice</span>
            <span class="o">+</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">productsPrice</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">productsPrice</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">?</span> <span class="mf">2.0</span> <span class="o">:</span> <span class="mf">3.0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">count</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">products</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Run Behat again:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>vendor/bin/behat
</pre></div>
</div>
<p>All scenarios should pass now! Congratulations, you almost finished your first
feature. The last step is to <em>refactor</em>. Look at the <code class="docutils literal"><span class="pre">Basket</span></code> and <code class="docutils literal"><span class="pre">Shelf</span></code>
classes and try to find a way to make their code even more cleaner, easier to
read and concise.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">I would recommend starting from <code class="docutils literal"><span class="pre">Basket::getTotalPrice()</span></code> method and
extracting VAT and delivery cost calculation in private methods.</p>
</div>
<p>After refactoring is done, you will have:</p>
<ol class="arabic simple">
<li>Clearly designed and obvious code that does exactly the thing it should do
without any gold plating.</li>
<li>A regression test suite that will help you to be confident in your code going
forward.</li>
<li>Living documentation for the behaviour of your code that will live, evolve and
die together with your code.</li>
<li>An incredible level of confidence in your code. Not only are you confident now
that it does exactly what it&#8217;s supposed to do, you are confident that it does
so by delivering value to the final users (customers in our case).</li>
</ol>
<p>There are many more benefits to BDD but those are the key reasons why most BDD
practitioners do BDD in Ruby, .Net, Java, Python and JS. Welcome to the family!</p>
</div>
<div class="section" id="what-s-next">
<h2>What&#8217;s Next?<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<p>Congratulations! You now know everything you need in order to get started
with behavior driven development and Behat. From here, you can learn more
about the <a class="reference internal" href="../user_guide/gherkin_language.html"><em>Gherkin</em></a> syntax or learn how to
test your web applications by using Behat with Mink.</p>
</div>
</div>


        </section>

    </section>

  </body>
</html>